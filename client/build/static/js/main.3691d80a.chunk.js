(this.webpackJsonppublic=this.webpackJsonppublic||[]).push([[0],{116:function(e,t){},125:function(e,t,a){var r={"./":3,"./comments":64,"./comments.js":64,"./index":3,"./index.js":3,"./package":68,"./package.json":68,"./posts":69,"./posts.js":69,"./users":70,"./users.js":70,"./yarn.lock":171};function n(e){var t=c(e);return a(t)}function c(e){if(!a.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}n.keys=function(){return Object.keys(r)},n.resolve=c,e.exports=n,n.id=125},169:function(e,t){},180:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),c=a(71),s=a.n(c),o=a(1),i=a.n(o),l=a(6),u=a(15),m=a(16),d=a(79),h=a(81),f=a(7),p=function(e){Object(h.a)(a,e);var t=Object(d.a)(a);function a(e){var r;Object(u.a)(this,a),(r=t.call(this,e)).componentDidMount=Object(l.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.a.authenticate({strategy:"local",email:"na@example.com",password:"password"});case 2:r.loadPosts();case 3:case"end":return e.stop()}}),e)}))),r.loadPosts=Object(l.a)(i.a.mark((function e(){var t,a,n,c,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.setState({loading:!0}),e.prev=1,e.next=4,f.a.service("server/profile").create({});case 4:return e.next=6,f.a.service("client/profile").create({});case 6:return t=(new Date).getTime(),e.next=9,f.a.service("api/posts").find({query:{$sort:{_id:1},$limit:r.state.limit},method:r.state.method,joinLocation:r.state.joinLocation});case 9:return a=e.sent,n=(new Date).getTime(),e.next=13,f.a.service("server/profile").find();case 13:return c=e.sent,e.next=16,f.a.service("client/profile").find();case 16:s=e.sent,r.setState({posts:a,duration:n-t,serverProfile:c,clientProfile:s,loading:!1,error:null}),e.next=23;break;case 20:e.prev=20,e.t0=e.catch(1),r.setState({error:e.t0,loading:!1});case 23:case"end":return e.stop()}}),e,null,[[1,20]])})));var n=new URLSearchParams(window.location.search).get("provider")||"socket";return r.state={loading:!0,error:null,serverProfile:null,clientProfile:null,posts:null,duration:null,useBatch:!1,limit:100,method:"primary",joinLocation:"client",provider:n},r}return Object(m.a)(a,[{key:"render",value:function(){var e=this,t=this.state,a=t.loading,r=t.error,c=t.serverProfile,s=t.clientProfile,o=t.posts,i=t.duration,l=t.useBatch,u=t.limit,m=t.method,d=t.joinLocation,h=t.provider;return n.a.createElement("div",{className:"container mt-4"},n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col col-sm-6"},n.a.createElement("div",{className:"mb-4"},n.a.createElement("h4",null,"Provider"),n.a.createElement("div",{className:"btn-group mb-2"},n.a.createElement("a",{className:"btn btn-secondary ".concat("socket"===h?"active":""),href:"/?provider=socket"},"Socket"),n.a.createElement("a",{className:"btn btn-secondary ".concat("rest"===h?"active":""),href:"/?provider=rest"},"REST")),n.a.createElement("p",null,"Configure the feathers-client to make calls either via Socket or REST")),n.a.createElement("div",{className:"mb-4"},n.a.createElement("h4",null,"Join Location"),n.a.createElement("div",{className:"btn-group mb-2"},n.a.createElement("button",{disabled:a,className:"btn btn-primary ".concat("client"!==d||l?"":"active"),onClick:function(){e.setState({joinLocation:"client",useBatch:!1},(function(){e.loadPosts(),f.a.set("useBatch",!1)}))}},"Client"),n.a.createElement("button",{disabled:a,className:"btn btn-primary ".concat("server"===d?"active":""),onClick:function(){e.setState({joinLocation:"server",useBatch:!1},(function(){e.loadPosts(),f.a.set("useBatch",!1)}))}},"Server"),n.a.createElement("button",{disabled:a,className:"btn btn-primary ".concat(l?"active":""),onClick:function(){e.setState({joinLocation:"client",useBatch:!0},(function(){e.loadPosts(),f.a.set("useBatch",!0)}))}},"feathers-batch")),n.a.createElement("p",null,"Choose between doing the joins on the client or the server. See also"," ",n.a.createElement("a",{href:"https://github.com/feathersjs-ecosystem/feathers-batch",target:"_blank",rel:"noopener noreferrer"},"feathers-batch"),'. Note that when using feathers-batch, you will see lots of client side calls, but its imporant to understand that these calls are not actual HTTP calls. The service was called, but it did not make a socket/rest request. It simply created "intructions" for feathers-batch.')),n.a.createElement("div",{className:"mb-4"},n.a.createElement("h4",null,"Methods"),n.a.createElement("div",{className:"btn-group mb-2"},n.a.createElement("button",{disabled:a,className:"btn btn-primary ".concat("primary"===m?"active":""),onClick:function(){e.setState({method:"primary"},e.loadPosts)}},"Get/Find"),n.a.createElement("button",{disabled:a,className:"btn btn-primary ".concat("cached"===m?"active":""),onClick:function(){e.setState({method:"cached"},e.loadPosts)}},"Cached Get/Find"),n.a.createElement("button",{disabled:a,className:"btn btn-primary ".concat("load"===m?"active":""),onClick:function(){e.setState({method:"load"},e.loadPosts)}},"Load/LoadMany")),n.a.createElement("ul",null,n.a.createElement("li",{className:"mb-2"},"Get/Find - Use standard Feathers .get() and .find() methods"),n.a.createElement("li",{className:"mb-2"},"Cached Get/Find - Use feathers-dataloader cached .get() and .find() methods. These are similar to basic Feathers get/find methods, but the request is cached and reused if another request with same id/params is made."),n.a.createElement("li",null,"Load/LoadMany - Use feathers-dataloader .load() and .loadMany() methods"))),n.a.createElement("div",{className:"mb-4"},n.a.createElement("h4",null,"Limit"),n.a.createElement("input",{type:"text",className:"form-control",value:u,onChange:function(t){var a=t.target.value;e.setState({limit:a},(function(){a&&e.loadPosts()}))}}))),n.a.createElement("div",{className:"col col-sm-6"},n.a.createElement("div",{className:"bg-light rounded p-3"},n.a.createElement("p",null,"This is a basic example app that compares doing joins/population on the client vs on the server. It is also a test bed and exmaple of a new v2 for"," ",n.a.createElement("a",{href:"https://github.com/feathersjs-ecosystem/batch-loader/tree/v2",target:"_blank",rel:"noopener noreferrer"},"feathers-dataloader"),". See also the"," ",n.a.createElement("a",{href:"https://github.com/feathersjs-ecosystem/batch-loader/issues/18",target:"_blank",rel:"noopener noreferrer"},"v2 RFC")," ","and leave some feedback! You can also checkout the"," ",n.a.createElement("a",{href:"https://github.com/DaddyWarbucks/test-feathers-client-joins",target:"_blank",rel:"noopener noreferrer"},"source code")," ","for this project. Specifically, see the ",n.a.createElement("code",null,"shared")," ","direcotry."),n.a.createElement("p",null,"The app consists of 5,000 ",n.a.createElement("code",null,"posts"),". The posts then join a ",n.a.createElement("code",null,"user")," and ",n.a.createElement("code",null,"comments"),". Each user then joins on a ",n.a.createElement("code",null,"bio"),", and each comment subsequently joins on its ",n.a.createElement("code",null,"user")," (and subsequently its bio)."),n.a.createElement("ul",null,n.a.createElement("li",{className:"mb-2"},"5,000 posts, each with random ",n.a.createElement("code",null,"user_id")),n.a.createElement("li",{className:"mb-2"},"10,000 comments, each with random ",n.a.createElement("code",null,"user_id")," and"," ",n.a.createElement("code",null,"post_id")),n.a.createElement("li",{className:"mb-2"},"100 users, each with corresponding ",n.a.createElement("code",null,"bio_id")),n.a.createElement("li",{className:"mb-2"},"100 bios")),n.a.createElement("p",null,'These relationships represent a good example of nested joins where some of those joins are "repeating" resources, such as the post joining its author and comments joinging their user. This is an excellent usecase for ',n.a.createElement("code",null,"feathers-datalader"),"."),n.a.createElement("p",null,"The app also uses"," ",n.a.createElement("a",{href:"https://github.com/feathersjs-ecosystem/feathers-batch",target:"_blank",rel:"noopener noreferrer"},"feathers-batch"),", which is a clever way of allowing the client to specify which joins to do, but actually executes that code on the server.")))),r&&n.a.createElement("div",{className:"alert alert-danger"},r.message),n.a.createElement("div",{className:"mb-4 p-3 bg-light rounded"},n.a.createElement("h3",null,"Duration:"," ",a?n.a.createElement("div",{className:"spinner-border",style:{width:"2rem",height:"2rem"}}):n.a.createElement("span",{className:"text-success"},i,"ms"))),n.a.createElement("div",{className:"row mb-4"},n.a.createElement("div",{className:"col"},n.a.createElement("h4",null,"Server Profile"),c&&n.a.createElement("pre",{className:"p-3 bg-light rounded"},JSON.stringify(c,null,2))),n.a.createElement("div",{className:"col"},n.a.createElement("h4",null,"Client Profile"),s&&n.a.createElement("pre",{className:"p-3 bg-light rounded"},JSON.stringify(s,null,2)))),n.a.createElement("div",null,n.a.createElement("div",{className:"mb-4"},n.a.createElement("h4",null,"Results"),o&&n.a.createElement("pre",{className:"p-3 bg-light rounded"},JSON.stringify(o,null,2)))))}}]),a}(n.a.Component);s.a.render(n.a.createElement(n.a.StrictMode,null,n.a.createElement(p,null)),document.getElementById("root"))},7:function(e,t,a){"use strict";(function(e){var r=a(1),n=a.n(r),c=a(26),s=a(6),o=a(18),i=a(82),l=a(72),u=a.n(l),m=a(19),d=a.n(m),h=a(27),f=a.n(h),p=a(73),b=a(74),v=a(75),E=a(76),g=a(77),y=a(78);e.hrtime=a(176);var j=a(177),w=j.profiler,k=j.getProfile,N=j.clearProfile,O=d()(),S=new URLSearchParams(window.location.search).get("provider")||"socket",P="production"===Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_API_PATH:"/"}).ENV?"/":"http://localhost:3030";"rest"===S?O.configure(d.a.rest(P).fetch(fetch)):O.configure(d.a.socketio(u()(P),{timeout:1e5})),O.configure(d.a.authentication()),O.mixins.push((function(e){e.loaderFactory=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!e.find)throw new Error("Cannot call the loaderFactory() method on this service because it does not have a find() method.");var a=t.params,r=void 0===a?{}:a,l=Object(i.a)(t,["params"]),u=Object(o.a)({id:"_id",multi:!1},l),m=Object(o.a)({paginate:!1},r);return new f.a(function(){var t=Object(s.a)(n.a.mark((function t(a){var r;return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.find(Object(o.a)({},m,{query:Object(o.a)(Object(c.a)({},u.id,{$in:f.a.getUniqueKeys(a)}),m.query)}));case 2:return r=t.sent,t.abrupt("return",f.a.getResultsByKey(a,r.data?r.data:r,(function(e){return e[u.id]}),u.multi?"[!]":"!"));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}})),O.configure(v.a),O.configure(E.a),O.configure(g.a),O.configure(y.a),O.configure(w({logger:null,stats:"total"})),O.set("profiler",{getProfile:k,clearProfile:N}),O.hooks(p.a),O.configure(Object(b.a)({batchService:"api/batch",exclude:["server/profile","client/profile","authentication"]})),O.setup(O),t.a=O}).call(this,a(5))},73:function(e,t,a){"use strict";var r=a(3);t.a={before:{all:[r.setupLoader,r.paramsForServer],find:[],get:[],create:[],update:[],patch:[],remove:[]},after:{all:[],find:[],get:[],create:[],update:[],patch:[],remove:[]},error:{all:[function(e){console.error(e.error)}],find:[],get:[],create:[],update:[],patch:[],remove:[]}}},74:function(e,t,a){"use strict";a.d(t,"a",(function(){return d}));var r=a(80),n=a(1),c=a.n(n),s=a(6),o=a(15),i=a(16),l=a(172).convert,u=function(){function e(t,a){Object(o.a)(this,e),this.app=t,this.batches=[],this.timeout=null,this.options=a}return Object(i.a)(e,[{key:"addBatchCall",value:function(e){var t=this;this.batches.push(e),null===this.timeout&&(this.timeout=setTimeout((function(){return t.flush()}),this.options.timeout||50))}},{key:"flush",value:function(){var e=Object(s.a)(c.a.mark((function e(){var t,a,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.batches,this.batches=[],this.timeout=null,a=this.options.batchService,e.next=6,this.app.service(a).create({calls:t.map((function(e){return e.payload}))});case 6:r=e.sent,t.forEach((function(e,t){var a=r[t];"fulfilled"===a.status?e.resolve(a.value):e.reject(l(a.reason))}));case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),m=function(e){var t=e.params.query,a=void 0===t?{}:t;switch(e.method){case"get":case"remove":return[e.id,a];case"update":case"patch":return[e.id,e.data,a];case"create":return[e.data,a];default:return[a]}},d=function(e){return function(t){if("string"!==typeof e.batchService)throw new Error("`batchService` name option must be passed to batchClient");var a=(e.exclude||[]).concat(e.batchService),n=new u(t,e),o=function(){var e=Object(s.a)(c.a.mark((function e(s){var o,i,l,u,d;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=s.method,i=s.path,t.get("useBatch")){e.next=3;break}return e.abrupt("return",s);case 3:if(!a.includes(i)){e.next=5;break}return e.abrupt("return",s);case 5:return l=m(s),u=[o,i].concat(Object(r.a)(l)),d=new Promise((function(e,t){return n.addBatchCall({resolve:e,reject:t,payload:u})})),e.next=10,d;case 10:return s.result=e.sent,e.abrupt("return",s);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();t.hooks({before:o})}}},75:function(e,t,a){"use strict";var r=a(3);t.a=function(e){e.service("api/posts").hooks({before:{all:[]},after:{all:[Object(r.switchHook)("posts","client")]}})}},76:function(e,t,a){"use strict";var r=a(1),n=a.n(r),c=a(6),s=a(15),o=a(16);t.a=function(e){var t=function(){function e(t,a){Object(s.a)(this,e),this.options=t||{}}return Object(o.a)(e,[{key:"setup",value:function(e){this.app=e,this.profiler=e.get("profiler")}},{key:"find",value:function(){var e=Object(c.a)(n.a.mark((function e(t){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.profiler.getProfile());case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"create",value:function(){var e=Object(c.a)(n.a.mark((function e(t,a){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.profiler.getProfile()&&this.profiler.clearProfile(),e.abrupt("return",{});case 2:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()}]),e}();return e.use("client/profile",new t),e.service("client/profile").hooks({after:{all:[function(e){return delete e._log,delete e.result["client/profile"],delete e.result["server/profile"],e}]}}),e}},77:function(e,t,a){"use strict";var r=a(3);t.a=function(e){e.service("api/comments").hooks({before:{all:[]},after:{all:[Object(r.switchHook)("comments","client")]}})}},78:function(e,t,a){"use strict";var r=a(3);t.a=function(e){e.service("api/users").hooks({before:{all:[]},after:{all:[Object(r.switchHook)("users","client")]}})}},83:function(e,t,a){e.exports=a(180)}},[[83,1,2]]]);
//# sourceMappingURL=main.3691d80a.chunk.js.map