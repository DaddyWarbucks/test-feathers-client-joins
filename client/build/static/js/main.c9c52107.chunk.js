(this.webpackJsonppublic=this.webpackJsonppublic||[]).push([[0],{114:function(e,t){},122:function(e,t,a){var r={"./":3,"./comments":63,"./comments.js":63,"./index":3,"./index.js":3,"./package":67,"./package.json":67,"./posts":68,"./posts.js":68,"./users":69,"./users.js":69,"./yarn.lock":168};function n(e){var t=s(e);return a(t)}function s(e){if(!a.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}n.keys=function(){return Object.keys(r)},n.resolve=s,e.exports=n,n.id=122},166:function(e,t){},168:function(e,t,a){e.exports=a.p+"static/media/yarn.1ac1a40b.lock"},177:function(e,t,a){"use strict";a.r(t);var r=a(12),n=a(13),s=a(78),o=a(80),i=a(0),c=a.n(i),l=a(70),u=a.n(l),m=a(1),h=a.n(m),d=a(8),p=a(27),f=a(6),b=a(179);var v=function(e){var t=f.a.useAppState(),a=Object(p.a)(t,2),r=a[0],n=r.limit,s=r.useBatch,o=r.maxBatchSize,i=r.method,l=r.joinLocation,u=r.provider,m=r.docsOpen,v=r.loading,g=r.error,E=r.serverProfile,w=r.clientProfile,x=r.posts,y=r.duration,k=a[1],j=function(e){k(e),S()},S=function(){var e=Object(d.a)(h.a.mark((function e(){var t,a,r,n,s,o,i,c,l,u;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return k({loading:!0,error:null}),t=f.a.getState(),a=t.limit,r=t.method,n=t.joinLocation,s=t.maxBatchSize,e.prev=2,e.next=5,f.a.service("server/profile").create({});case 5:return e.next=7,f.a.service("client/profile").create({});case 7:return o=(new Date).getTime(),e.next=10,f.a.service("api/posts").find({query:{$sort:{_id:1},$limit:a||1},method:r,joinLocation:n,maxBatchSize:s});case 10:return i=e.sent,c=(new Date).getTime(),e.next=14,f.a.service("server/profile").find();case 14:return l=e.sent,e.next=17,f.a.service("client/profile").find();case 17:u=e.sent,k({posts:i,duration:c-o,serverProfile:l,clientProfile:u,loading:!1}),e.next=25;break;case 21:e.prev=21,e.t0=e.catch(2),console.error(e.t0),k({error:e.t0,loading:!1});case 25:case"end":return e.stop()}}),e,null,[[2,21]])})));return function(){return e.apply(this,arguments)}}();Object(b.a)((function(){var e={strategy:"local",email:"na@example.com",password:"password"};Promise.all([f.a.authenticate(e),f.a.socketApp.authenticate(e)]).then((function(){S()})).catch((function(e){k({error:e,loading:!1})}))}));var N=s&&"client"===l;return c.a.createElement("div",{className:"container-fluid mt-4"},c.a.createElement("p",{className:"lead"},"This is a basic example app that compares doing joins/population on the client vs on the server. It is also a test bed and exmaple of a new v2 for"," ",c.a.createElement("a",{href:"https://github.com/feathersjs-ecosystem/batch-loader/tree/v2",target:"_blank",rel:"noopener noreferrer"},"feathers-dataloader"),". See also the"," ",c.a.createElement("a",{href:"https://github.com/feathersjs-ecosystem/batch-loader/issues/18",target:"_blank",rel:"noopener noreferrer"},"v2 RFC")," ","and leave some feedback! You can also checkout the"," ",c.a.createElement("a",{href:"https://github.com/DaddyWarbucks/test-feathers-client-joins",target:"_blank",rel:"noopener noreferrer"},"source code")," ","for this project. Specifically, see the ",c.a.createElement("code",null,"shared")," direcotry."),c.a.createElement("div",{className:"card mb-4 card-light"},c.a.createElement("div",{className:"card-header d-flex justify-content-between"},c.a.createElement("h3",{className:"mb-0"},"Docs"),c.a.createElement("button",{className:"btn btn-primary",onClick:function(){k({docsOpen:!m})}},m?"Hide":"Show")),c.a.createElement("div",{className:"card-body ".concat(m?"":"d-none")},c.a.createElement("p",null,"The app makes one request to"," ",c.a.createElement("code",null,"app.service('api/posts').find()"),". The posts then join a"," ",c.a.createElement("code",null,"user")," and ",c.a.createElement("code",null,"comments"),". Each user then joins on a ",c.a.createElement("code",null,"bio"),", and each comment subsequently joins on its"," ",c.a.createElement("code",null,"user")," (and subsequently its bio)."),c.a.createElement("ul",null,c.a.createElement("li",{className:"mb-2"},"10,000 posts, each with random ",c.a.createElement("code",null,"user_id")),c.a.createElement("li",{className:"mb-2"},"50,000 comments, each with random ",c.a.createElement("code",null,"user_id")," and"," ",c.a.createElement("code",null,"post_id")),c.a.createElement("li",{className:"mb-2"},"5,000 users, each with corresponding ",c.a.createElement("code",null,"bio_id")),c.a.createElement("li",{className:"mb-2"},"5,000 bios")),c.a.createElement("p",null,'These relationships represent a good example of nested joins where some of those joins are "repeating" resources, such as the post joining its author and comments joinging their user. This is an excellent usecase for ',c.a.createElement("code",null,"feathers-datalader"),"."),c.a.createElement("ul",null,c.a.createElement("li",{className:"mb-2"},"The app also uses"," ",c.a.createElement("a",{href:"https://github.com/feathersjs-ecosystem/feathers-batch",target:"_blank",rel:"noopener noreferrer"},"feathers-batch"),', which is a clever way of allowing the client to specify which joins to do, but actually executes that code on the server. Note that when using feathers-batch, you will see lots of client side calls, but its imporant to understand that these calls are not actual HTTP requests. The service was called, but it did not make a socket/rest request. It simply created "intructions" for feathers-batch.'),c.a.createElement("li",{className:"mb-2"},"The app uses authentication. This means that there are additional requests to"," ",c.a.createElement("code",null,"app.service('api/users').get(authedUserId)")," in the authentication hooks. Note the difference this makes when using the different join types."),c.a.createElement("li",{className:"mb-2"},"For simplicty in this example, the app uses NeDB as its database. NeDB is a filesystem database where the records are just flat JSON files. But, its important to note that it is not making an HTTP request to some database server that lives on another machine. As impressive as the different loading techniques are, it should be noted that on a production database there would be a corresponding number of HTTP requests (think about all thos .get() requests...). The potential resources and performance benefits are quite large."),c.a.createElement("li",null,"When using REST, the browser enforces a character limit on URL length. Dataloader creates long URL's containing a list of ID's. Set the \"maxBatchSize\" to set dataloader option which limits the number of keys in the URL by maxing out and then starting a new batch. For this app, that limit is about 20 because of the long length of the UUID's. But, you probaly want to unset it when using server or socket side joins.")))),g&&c.a.createElement("div",{className:"alert alert-danger"},g.message),c.a.createElement("div",{className:"row mb-4"},c.a.createElement("div",{className:"col-sm-auto"},c.a.createElement("h4",null,"Provider"),c.a.createElement("div",{className:"btn-group mb-2"},c.a.createElement("button",{disabled:v,className:"btn btn-secondary ".concat("socket"===u?"active":""),onClick:function(){j({provider:"socket"})}},"Socket"),c.a.createElement("button",{disabled:v,className:"btn btn-secondary ".concat("rest"===u?"active":""),onClick:function(){return j(N?{provider:"rest",maxBatchSize:Math.min(o,20)}:{provider:"rest"})}},"REST")),c.a.createElement("p",null,"Configure the client to make ",c.a.createElement("br",null)," calls via Socket or REST")),c.a.createElement("div",{className:"col-sm-auto"},c.a.createElement("h4",null,"Join Location"),c.a.createElement("div",{className:"mb-2"},c.a.createElement("div",{className:"btn-group mr-2"},c.a.createElement("button",{disabled:v,className:"btn btn-info ".concat(s||"client"!==l?"":"active"),onClick:function(){return j(N?{joinLocation:"client",maxBatchSize:Math.min(o,20)}:{joinLocation:"client"})}},"Client"),c.a.createElement("button",{disabled:v,className:"btn btn-info ".concat(s?"active":""),onClick:function(){j({useBatch:!s})}},"BatchClient")),c.a.createElement("button",{disabled:v,className:"btn btn-info ".concat("server"===l?"active":""),onClick:function(){j({joinLocation:"server"})}},"Server")),c.a.createElement("p",null,"Choose between doing joins on the ",c.a.createElement("br",null)," client or the server. See also"," ",c.a.createElement("a",{href:"https://github.com/feathersjs-ecosystem/feathers-batch",target:"_blank",rel:"noopener noreferrer"},"feathers-batch"),".")),c.a.createElement("div",{className:"col-sm-auto"},c.a.createElement("h4",null,"Methods"),c.a.createElement("div",{className:"btn-group mb-2"},c.a.createElement("button",{disabled:v,className:"btn btn-success ".concat("primary"===i?"active":""),onClick:function(){j({method:"primary"})}},"Service"),c.a.createElement("button",{disabled:v,className:"btn btn-success ".concat("cached"===i?"active":""),onClick:function(){j({method:"cached"})}},"CachedService"),c.a.createElement("button",{disabled:v,className:"btn btn-success ".concat("load"===i?"active":""),onClick:function(){j({method:"load"})}},"DataLoader"),"load"===i&&c.a.createElement("div",{className:"d-inline position-relative",style:{maxWidth:130}},c.a.createElement("div",{style:{right:10,top:6,position:"absolute"}},c.a.createElement("span",{style:{fontSize:"0.7rem"}},"maxBatchSize")),c.a.createElement("input",{disabled:v,type:"number",max:N?20:void 0,className:"form-control",value:"load"===i?o:void 0,onChange:function(e){var t=e.target.value;j({maxBatchSize:t})}}))),c.a.createElement("p",null,"User feathers get/find methods. Or checkout ",c.a.createElement("br",null),c.a.createElement("a",{href:"https://github.com/feathersjs-ecosystem/batch-loader/issues/18",target:"_blank",rel:"noopener noreferrer"},"v2 RFC")," ",'for more info. See docs for "maxBatchSize".')),c.a.createElement("div",{className:"col-sm-auto"},c.a.createElement("h4",null,"Limit"),c.a.createElement("div",{style:{maxWidth:120}},c.a.createElement("input",{disabled:v,type:"number",placeholder:"limit",max:1e4,className:"form-control mb-2",value:n,onChange:function(e){var t=e.target.value;j({limit:t})}})),c.a.createElement("p",null,"Set a up to 10,000."))),c.a.createElement("div",{className:"mb-4 p-3 bg-light rounded"},c.a.createElement("h3",null,"Duration:"," ",v?c.a.createElement("div",{className:"spinner-border",style:{width:"2rem",height:"2rem"}}):c.a.createElement("span",{className:"text-success"},y,"ms"))),c.a.createElement("div",{className:"row mb-4"},c.a.createElement("div",{className:"col"},c.a.createElement("h4",null,"Server Profile"),E&&c.a.createElement("pre",{className:"p-3 bg-light rounded"},JSON.stringify(E,null,2))),c.a.createElement("div",{className:"col"},c.a.createElement("h4",null,"Client Profile"),w&&c.a.createElement("pre",{className:"p-3 bg-light rounded"},JSON.stringify(w,null,2)))),c.a.createElement("div",null,c.a.createElement("div",{className:"mb-4"},c.a.createElement("h4",null,"Results"),x&&c.a.createElement("pre",{className:"p-3 bg-light rounded"},JSON.stringify(x,null,2)))))},g=function(e){Object(o.a)(a,e);var t=Object(s.a)(a);function a(e){var n;return Object(r.a)(this,a),(n=t.call(this,e)).state={error:null},n}return Object(n.a)(a,[{key:"componentDidCatch",value:function(e){this.setState({error:e})}},{key:"render",value:function(){return this.state.error?c.a.createElement("div",{className:"d-flex vh-100 align-items-center justify-content-center"},c.a.createElement("div",{className:"p-4 bg-white shadow rounded"},c.a.createElement("h3",{className:"text-danger mb-4"},this.state.error.message||"Something went wrong!"),c.a.createElement("a",{href:window.location,className:"btn btn-primary btn-block"},"Reload Page"))):this.props.children}}]),a}(c.a.Component);u.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(g,null,c.a.createElement(v,null))),document.getElementById("root"))},3:function(e,t,a){var r=a(24),n=a(57),s=a(119).ContextLoader;e.exports.makeParams=function(e){return{method:e.params.method,joinLocation:e.params.joinLocation,maxBatchSize:e.params.maxBatchSize,loader:e.params.loader}},e.exports.paramsFromClient=function(e){if(e.params.provider){var t=e.params.query||{},a=t.method,s=t.joinLocation,o=t.maxBatchSize,i=n(t,["method","joinLocation","maxBatchSize"]);e.params=r({},e.params,{query:i,method:a,joinLocation:s,maxBatchSize:o})}return e},e.exports.paramsForServer=function(e){var t=e.params,a=t.method,n=t.joinLocation,s=t.maxBatchSize;return e.params.query=r({},e.params.query,{method:a,joinLocation:n,maxBatchSize:s}),e},e.exports.setupLoader=function(e){if(!e.params.loader){var t=new s(e);e.params.loader=t.loader}return e},e.exports.switchHook=function(e,t){return function(r){var n=r.params,s=n.joinLocation,o=n.method;if(!s||!o)return r;if(s!==t)return r;var i=a(122)("./".concat(e)),c=i.withResultsPrimary,l=i.withResultsCached,u=i.withResultsLoad;switch(o){case"primary":return c(r);case"cached":return l(r);case"load":return u(r);default:return r}}}},6:function(e,t,a){"use strict";(function(e){var r=a(27),n=a(38),s=a(71),o=a.n(s),i=a(14),c=a.n(i),l=a(72),u=a(73),m=a(0),h=a(74),d=a(75),p=a(76),f=a(77);e.hrtime=a(173);var b=a(174),v=b.profiler,g=b.getProfile,E=b.clearProfile,w=window.location.origin,x={limit:10,useBatch:!1,maxBatchSize:20,method:"primary",joinLocation:"client",provider:"rest",docsOpen:!1,loading:!0,error:null,serverProfile:null,clientProfile:null,posts:null,duration:null},y=function(e){x=Object(n.a)({},x,{},e)},k=function(){return Object(n.a)({},x)},j=function(){var e=Object(m.useState)({}),t=Object(r.a)(e,2)[1],a=Object(m.useCallback)((function(e){y(e),t({})}),[]);return[x,a]},S=function(e){return e.configure(c.a.authentication()),e.setState=y,e.getState=k,e.useAppState=j,e.configure(h.a),e.configure(d.a),e.configure(p.a),e.configure(f.a),e.configure(v({logger:null,stats:"total"})),e.set("profiler",{getProfile:g,clearProfile:E}),e.hooks(l.a),e.configure(Object(u.a)({batchService:"api/batch",timeout:3,exclude:["server/profile","client/profile","authentication"]})),e.setup(e),e},N=c()();N.configure(c.a.rest(w).fetch(fetch)),S(N);var B=c()();B.configure(c.a.socketio(o()(w),{timeout:1e5})),S(B),N.socketApp=B;var O=N.service;N.service=function(e){return"rest"===N.getState().provider?O.call(this,e):N.socketApp.service(e)},t.a=N}).call(this,a(5))},63:function(e,t,a){var r=a(1),n=a(2),s=a(34).withResult,o=a(3).makeParams;e.exports.withResultsPrimary=s({user:function(){var e=n(r.mark((function e(t,a){var n;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.app.service("api/users").get(t.user_id,o(a));case 2:return delete(n=e.sent).password,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()}),e.exports.withResultsLoad=s({user:function(){var e=n(r.mark((function e(t,a){var n,s,i;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o(a),s=n.maxBatchSize,e.next=3,a.params.loader("api/users",{maxBatchSize:s}).load({_id:t.user_id},null,o(a));case 3:return delete(i=e.sent).password,e.abrupt("return",i);case 6:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()}),e.exports.withResultsCached=s({user:function(){var e=n(r.mark((function e(t,a){var n;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.params.loader("api/users").get(t.user_id,null,o(a));case 2:return delete(n=e.sent).password,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()})},67:function(e){e.exports=JSON.parse('{"name":"shared","version":"1.0.0","main":"index.js","license":"MIT","dependencies":{"@feathers-plus/batch-loader":"https://github.com/feathersjs-ecosystem/batch-loader.git#v2","feathers-fletching":"^1.12.2"}}')},68:function(e,t,a){var r=a(24),n=a(1),s=a(2),o=a(34).withResult,i=a(3).makeParams;e.exports.withResultsPrimary=o({user:function(){var e=s(n.mark((function e(t,a){var r;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.app.service("api/users").get(t.user_id,i(a));case 2:return delete(r=e.sent).password,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),comments:function(e,t){return t.app.service("api/comments").find(r({query:{post_id:e._id}},i(t)))}}),e.exports.withResultsLoad=o({user:function(){var e=s(n.mark((function e(t,a){var r,s,o;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i(a),s=r.maxBatchSize,e.next=3,a.params.loader("api/users",{maxBatchSize:s}).load({_id:t.user_id},null,i(a));case 3:return delete(o=e.sent).password,e.abrupt("return",o);case 6:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),comments:function(e,t){var a=i(t).maxBatchSize;return t.params.loader("api/comments",{maxBatchSize:a}).loadMany({post_id:e._id},null,i(t))}}),e.exports.withResultsCached=o({user:function(){var e=s(n.mark((function e(t,a){var r;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.params.loader("api/users").get(t.user_id,null,i(a));case 2:return delete(r=e.sent).password,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),comments:function(e,t){return t.params.loader("api/comments").find({query:{post_id:e._id}},i(t))}})},69:function(e,t,a){var r=a(34).withResult,n=a(3).makeParams;e.exports.withResultsPrimary=r({bio:function(e,t){return t.app.service("api/bios").get(e.bio_id,n(t))}}),e.exports.withResultsLoad=r({bio:function(e,t){var a=n(t).maxBatchSize;return t.params.loader("api/bios",{maxBatchSize:a}).load({_id:e.bio_id},null,n(t))}}),e.exports.withResultsCached=r({bio:function(e,t){return t.params.loader("api/bios").get(e.bio_id,null,n(t))}})},72:function(e,t,a){"use strict";var r=a(3);t.a={before:{all:[r.setupLoader,r.paramsForServer],find:[],get:[],create:[],update:[],patch:[],remove:[]},after:{all:[],find:[],get:[],create:[],update:[],patch:[],remove:[]},error:{all:[function(e){console.error(e.error)}],find:[],get:[],create:[],update:[],patch:[],remove:[]}}},73:function(e,t,a){"use strict";a.d(t,"a",(function(){return h}));var r=a(79),n=a(1),s=a.n(n),o=a(8),i=a(12),c=a(13),l=a(169).convert,u=function(){function e(t,a){Object(i.a)(this,e),this.app=t,this.batches=[],this.timeout=null,this.options=a}return Object(c.a)(e,[{key:"addBatchCall",value:function(e){var t=this;this.batches.push(e),null===this.timeout&&(this.timeout=setTimeout((function(){return t.flush()}),this.options.timeout||50))}},{key:"flush",value:function(){var e=Object(o.a)(s.a.mark((function e(){var t,a,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.batches,this.batches=[],this.timeout=null,a=this.options.batchService,e.next=6,this.app.service(a).create({calls:t.map((function(e){return e.payload}))});case 6:r=e.sent,t.forEach((function(e,t){var a=r[t];"fulfilled"===a.status?e.resolve(a.value):e.reject(l(a.reason))}));case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),m=function(e){var t=e.params.query,a=void 0===t?{}:t;switch(e.method){case"get":case"remove":return[e.id,a];case"update":case"patch":return[e.id,e.data,a];case"create":return[e.data,a];default:return[a]}},h=function(e){return function(t){if("string"!==typeof e.batchService)throw new Error("`batchService` name option must be passed to batchClient");var a=(e.exclude||[]).concat(e.batchService),n=new u(t,e),i=function(){var e=Object(o.a)(s.a.mark((function e(o){var i,c,l,u,h,d;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=o.method,c=o.path,l=t.getState(),l.useBatch){e.next=4;break}return e.abrupt("return",o);case 4:if(!a.includes(c)){e.next=6;break}return e.abrupt("return",o);case 6:return u=m(o),h=[i,c].concat(Object(r.a)(u)),d=new Promise((function(e,t){return n.addBatchCall({resolve:e,reject:t,payload:h})})),e.next=11,d;case 11:return o.result=e.sent,e.abrupt("return",o);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();t.hooks({before:i})}}},74:function(e,t,a){"use strict";var r=a(3);t.a=function(e){e.service("api/posts").hooks({before:{all:[]},after:{all:[Object(r.switchHook)("posts","client")]}})}},75:function(e,t,a){"use strict";var r=a(1),n=a.n(r),s=a(8),o=a(12),i=a(13);t.a=function(e){var t=function(){function e(t,a){Object(o.a)(this,e),this.options=t||{}}return Object(i.a)(e,[{key:"setup",value:function(e){this.app=e,this.profiler=e.get("profiler")}},{key:"find",value:function(){var e=Object(s.a)(n.a.mark((function e(t){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.profiler.getProfile());case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"create",value:function(){var e=Object(s.a)(n.a.mark((function e(t,a){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.profiler.getProfile()&&this.profiler.clearProfile(),e.abrupt("return",{});case 2:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()}]),e}();return e.use("client/profile",new t),e.service("client/profile").hooks({after:{all:[function(t){var a=e.getState().useBatch;return delete t._log,delete t.result["client/profile"],delete t.result["server/profile"],delete t.result.authentication,a&&(delete t.result["api/users"],delete t.result["api/comments"],delete t.result["api/bios"]),t}]}}),e}},76:function(e,t,a){"use strict";var r=a(3);t.a=function(e){e.service("api/comments").hooks({before:{all:[]},after:{all:[Object(r.switchHook)("comments","client")]}})}},77:function(e,t,a){"use strict";var r=a(3);t.a=function(e){e.service("api/users").hooks({before:{all:[]},after:{all:[Object(r.switchHook)("users","client")]}})}},81:function(e,t,a){e.exports=a(177)}},[[81,1,2]]]);
//# sourceMappingURL=main.c9c52107.chunk.js.map